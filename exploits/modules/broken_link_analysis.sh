#!/bin/bash

# Usage: ./broken_link_analysis.sh https://example.com
# Requires: curl, grep, sed

if [ -z "$1" ]; then
    echo "Usage: $0 <url>"
    exit 1
fi

TARGET="$1"
TMPFILE=$(mktemp)

echo "[*] Crawling: $TARGET"
curl -s "$TARGET" | grep -Eo 'href="[^"]+"' | sed 's/href="//;s/"$//' | sort -u > "$TMPFILE"

echo "[*] Found $(wc -l < "$TMPFILE") links."
echo "-----------------------------------"

while read -r LINK; do
    # Handle relative links
    if [[ "$LINK" != http* ]]; then
        LINK="${TARGET%/}/$LINK"
    fi
    
    STATUS=$(curl -o /dev/null -s -w "%{http_code}" "$LINK")
    
    if [[ "$STATUS" -ge 400 ]]; then
        echo "[BROKEN] $LINK -> HTTP $STATUS"
    else
        echo "[OK]     $LINK -> HTTP $STATUS"
    fi
done < "$TMPFILE"

rm "$TMPFILE"
